<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>主页</title>
    <link href="/resources/css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
    <link href="/resources/css/font-awesome.min.css?v=4.3.0" rel="stylesheet">
    <link href="/resources/css/animate.min.css" rel="stylesheet">
    <link href="/resources/css/style.min.css?v=3.2.0" rel="stylesheet">
    <script src="/resources/js/angular.min.js"></script>
</head>
<body class="gray-bg">

<div class="wrapper wrapper-content animated fadeIn" ng-app="myapp" ng-controller="rolectrl"
     ng-init="quantity=1;price=5;names=['Jane','KangKang','Jack']">
    <p>名字一定是 : <input type="text" ng-model="name"></p>

    <h1>Hello {{name}}</h1>

    <p>
        quantity:{{ quantity }}
    </p>

    <p>
        price:{{ price }}
    </p>

    <p>下面循环</p>
    <ul>
        <li ng-repeat="name in names">
            {{name }}
        </li>
    </ul>
    <mine></mine>

    <div class="input-append">
        <input style="width:358px; margin-left: 100px;" type="text" ng-model="name" required min="1"/>
        <button class="btn btn-primary" ng-disabled="!name" ng-click="add(name)">Add User</button>
    </div>
    <table class="table table-bordered table-striped" style="width:450px; margin-left: 100px;"
           ng-show="roles.length > 0">
        <thead>
        <tr>
            <th style="text-align: center; width: 25px;">Action</th>
            <th style="text-align: center;">User Name</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="role in roles">
            <td style="width:70px;text-align:center;">
                <button class="btn btn-mini btn-danger" ng-click="del(role.id)">Remove</button>
            </td>
            <td>{{role}}</td>
        </tr>
        </tbody>
    </table>
    <select ng-options="role.name for role in roles" ng-model="sel_role"></select>

    <p>选择的角色ID: {{ sel_role.id }}</p>
</div>

<script>
    var app = angular.module("myapp", []);
    app.value("defaultInputValue", 5);
    app.directive("mine", function () {
        return {template: '<h1>自定义模块<h1>'};
    });

    //创建一个factory
    app.factory("MathService", function () {
        var factory = {};
        factory.multiply = function (a, b) {
            return a * b;
        };
        return factory;
    });

    //在CalcService中注入 factory的 MathService
    app.service("CalcService", function (MathService) {
        this.square = function (a) {
            return MathService.multiply(a, a);
        };
    });

    //使用 provider创建service定义一个方法用于计算两数的乘积
    app.config(function ($provide) {
        $provide.provider("MathService", function () {
            this.$get = function () {
                var factory = {};
                factory.multiply = function (a, b) {
                    return a * b
                };
                return factory;
            };
        });
    });

    app.controller("rolectrl", function ($scope, $http, $location, CalcService) {
        $scope.number = defaultInputValue;
        $scope.url = $location.absUrl();
        $scope.result = CalcService.square($scope.number);
        $scope.square = function () {
            $scope.result = CalcService.square($scope.result);
        };
        $scope.list = function () {
            $http({method: "PATCH", url: "/role"}).success(function (result) {
                $scope.roles = result.rows;
            });
        };
        $scope.add = function (name) {
            $http.post("/role", {"name": name}).success(function (result) {
                $scope.list();
            });
        };
        $scope.del = function (id) {
            $http.delete("/role/" + id).success(function (result) {
                $scope.list();
            });
        };
        $scope.delAll = function () {
        };

        $scope.list();
    })
</script>
</body>
</html>
